

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Code-specific steps for FluDAG &#8212; DAGMC</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/default.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Code-specific steps for DAG-Tripoli4" href="dag-tripoli4.html" />
    <link rel="prev" title="Tallies" href="dag-mcnp_deprecated.html" /> 
  </head><body> 
<div id="page-div" class="page">
<div id="header">
    <a id="uwhome" href="http://www.wisc.edu"><img src="../../_static/images/wordmark.gif" alt="University of Wisconsin–Madison" width="260" height="11" /></a> 
    <a id="crest" href="http://www.wisc.edu"><img src="../../_static/images/crest.png" alt="" width="70" height="106" /></a>
    <h1 id="siteTitle"><a href="../../index.html"><img src="../../_static/images/logo.png" alt="" height="50x" /><span>DAGMC</span></a></h1>
    <div id="tagline"><span>Direct Accelerated Geometry Monte Carlo Toolkit</span></div>
    <ul id="globalnav">
      <li id="uwsearch"><a href="http://www.wisc.edu/search/">UW Search</a></li>
      <li><a href="http://cnerg.github.com">CNERG</a></li>
      <li><a href="http://my.wisc.edu">My UW</a></li>
      <li><a href="http://map.wisc.edu">Map</a></li>
      <li id="last_tool"><a href="http://www.today.wisc.edu">Calendar</a></li>
    </ul>
    <form role="search" action="../../search.html" method="get" id="cse-search-box">
      <div>
      <label class="screen-reader-text" for="q">Search for:</label>
      <input type="text" id="q" name="q" value="Enter keywords here...." />
      <input type="submit" id="sa" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
      </div>
    </form>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>

    <div id="nav" class="main-menu-container">
      <ul id="menu-main" class="sf-menu">
        <li class="menu-item"><a href="http://svalinn.github.io">Svalinn</a></li>
        <li class="menu-item"><a href="../../index.html">DAGMC</a></li>
        <li class="menu-item" style="margin-right: 10px">
          <a href="dag-mcnp_deprecated.html" title="Tallies"
             accesskey="P">previous</a>
          </li>
        <li class="menu-item" >
          <a href="dag-tripoli4.html" title="Code-specific steps for DAG-Tripoli4"
             accesskey="N">next</a>
          </li>
        <li class="menu-item" >
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a>
          </li>
          <li class="menu-item"><a href="../index.html" >User’s guide</a></li>
          <li class="menu-item"><a href="index.html" accesskey="U">Monte Carlo code-specific steps</a></li> 
      </ul>
    </div>
  <div id="c_container"> 
<div id="sidebar">
 <div id="sidebar_section"><ul>
<li><a class="reference internal" href="#">Code-specific steps for FluDAG</a><ul>
<li><a class="reference internal" href="#geometry-metadata">Geometry metadata</a><ul>
<li><a class="reference internal" href="#assigning-materials-and-densities">Assigning materials and densities</a></li>
<li><a class="reference internal" href="#defining-the-graveyard">Defining the graveyard</a></li>
<li><a class="reference internal" href="#scoring-assignments">Scoring assignments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#preparing-the-fludag-input-file">Preparing the FluDAG input file</a></li>
<li><a class="reference internal" href="#running-fludag">Running FluDAG</a></li>
</ul>
</li>
</ul>
 </div>
</div> 
    <div id="content" class="inline-block">
          <div class="post">
            
  <section id="code-specific-steps-for-fludag">
<h1>Code-specific steps for FluDAG<a class="headerlink" href="#code-specific-steps-for-fludag" title="Permalink to this heading">¶</a></h1>
<p>There are several varieties of code-specific steps:</p>
<ol class="arabic simple">
<li><p>Defining attributes of the geometry using groups in Cubit</p></li>
<li><p>Producing material assignments in FLUKA input format from the h5m file, with
the help of FluDAG</p></li>
<li><p>Preparing the FLUKA input file for running with DAGMC</p></li>
<li><p>Inserting the material assignments into the FLUKA input deck</p></li>
</ol>
<section id="geometry-metadata">
<h2>Geometry metadata<a class="headerlink" href="#geometry-metadata" title="Permalink to this heading">¶</a></h2>
<p>In FluDAG, the geometry file can be used to define material assignments.
Eventually we would like to add the capability to define boundary conditions and
tally locations.</p>
<section id="assigning-materials-and-densities">
<h3>Assigning materials and densities<a class="headerlink" href="#assigning-materials-and-densities" title="Permalink to this heading">¶</a></h3>
<p>The generic workflow description includes details on <a class="reference internal" href="../cubit_basics.html#grouping-basics"><span class="std std-ref">Grouping volumes and surfaces</span></a>,
but a specific naming convention is required for FluDAG. To define materials,
the FLUKA material name must be provided in the group name. The group name must
be that of a valid FLUKA material; for example, any of the default materials or
a valid COMPOUND name. Note that you are limited to 8 characters, as in FLUKA.
The format for the group name is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mat:[material_name]
</pre></div>
</div>
<p>For example, suppose we wish to add volumes 1 through 5 to a group that defines
the material to be iron. The following command would be used.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CUBIT&gt; group &quot;mat:IRON&quot; add volume 1 to 5
</pre></div>
</div>
<p>This will produce in the input file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ASSIGNMA        IRON         1
ASSIGNMA        IRON         2
ASSIGNMA        IRON         3
ASSIGNMA        IRON         4
ASSIGNMA        IRON         5
</pre></div>
</div>
<p>Compounds are also supported by FluDAG; for example, if we wish to have volume 6
belong to a group whose material name is STAINLESS then we can can use</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CUBIT&gt; group &quot;mat:STAINLESS&quot; add volume 6
</pre></div>
</div>
<p>This will produce in the input file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MATERIAL                                        26                    STAINLES
*...+....1....+....2....+....3....+....4....+....5....+....6....+....7...
ASSIGNMA    STAINLES         6
</pre></div>
</div>
<dl class="simple">
<dt>Some notes:</dt><dd><ul class="simple">
<li><p>Material names longer than 8 characters are truncated to the first 8
characters.</p></li>
<li><p>There are several predefined material names in FLUKA, and they are
appropriately treated by FluDAG.</p></li>
<li><p>All volumes must belong to a group. If any are not, FluDAG will not assign
material information for them.</p></li>
</ul>
</dd>
</dl>
<p>The implicit complement is automatically assigned the value 1 + the id of the
highest-numbered volume. You can easily modify what material property that you
would like the implicit compliment (or any other volume) to have by changing the
material on the ASSIGNMAT card.</p>
</section>
<section id="defining-the-graveyard">
<h3>Defining the graveyard<a class="headerlink" href="#defining-the-graveyard" title="Permalink to this heading">¶</a></h3>
<p>Typical FLUKA models contain a zero-importance volume that bounds the volumes of
interest and extends to infinity. Since solid models cannot include infinite
volumes, it is necessary to define a finite zero-importance volume around your
model to define the problem boundary. This is done by surrounding the entire
geometry with a shell of finite thickness; this is known as the “graveyard.” Any
geometric shape can be used for this, but a cubic shell is preferred. The
graveyard represents the outside world, and any particle that enters it will be
terminated.</p>
<p>To create a graveyard volume, create two volumes in Cubit with the same shape
and same center with one slightly larger than the other, making sure that both
bound the entire problem geometry. Then, subtract the smaller one from the
larger one. The remaining volume is the graveyard.</p>
<p>To indicate to FLUKA that a given volume is the graveyard volume, you must
assign it to a group with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CUBIT&gt; group &quot;mat:BLCKHOLE&quot; add volume X
</pre></div>
</div>
<p>For example, consider a geometry containing 99 volumes, all of which fit inside
a cube of side length 99 cm centered at the origin. The following commands would
create a valid graveyard for this problem:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CUBIT&gt; create brick x 100             # This will be volume 100
CUBIT&gt; create brick x 105             # This will be volume 101
CUBIT&gt; subtract vol 100 from vol 101  # This will produce volume 102
CUBIT&gt; group &quot;mat:BLCKHOLE&quot; add vol 102
</pre></div>
</div>
<p>When FluDAG is run, the importance of any graveyard volumes will be set to zero.</p>
</section>
<section id="scoring-assignments">
<h3>Scoring assignments<a class="headerlink" href="#scoring-assignments" title="Permalink to this heading">¶</a></h3>
<p>DAGMC does not currently support scoring assignments through group names. Users
must add these to the FLUKA input deck manually.</p>
</section>
</section>
<section id="preparing-the-fludag-input-file">
<h2>Preparing the FluDAG input file<a class="headerlink" href="#preparing-the-fludag-input-file" title="Permalink to this heading">¶</a></h2>
<p>The FluDAG input file will look almost identical to the originating FLUKA input
file. The exception will be the removal of all data between the cards
<code class="docutils literal notranslate"><span class="pre">GEOBEGIN</span></code> and <code class="docutils literal notranslate"><span class="pre">GEOEND</span></code>, i.e. all native FLUKA input data. The last entry
on the line of <code class="docutils literal notranslate"><span class="pre">GEOBEGIN</span></code> should be <code class="docutils literal notranslate"><span class="pre">FLUGG</span></code>.</p>
<p>For example, the most simple valid FLUKA geometry is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>GEOBEGIN                                                              COMBNAME
    0    0
SPH S1         0.0 0.0 0.0 50.0
CELL1        5 +S1
CELL2        5 -S1
GEOEND
</pre></div>
</div>
<p>To run this geometry with FluDAG, remove all data between <code class="docutils literal notranslate"><span class="pre">GEOBEGIN</span></code> and
<code class="docutils literal notranslate"><span class="pre">GEOEND</span></code>, and switch the last entry to <code class="docutils literal notranslate"><span class="pre">FLUGG</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>GEOBEGIN                                                              FLUGG
GEOEND
</pre></div>
</div>
</section>
<section id="running-fludag">
<h2>Running FluDAG<a class="headerlink" href="#running-fludag" title="Permalink to this heading">¶</a></h2>
<p>Running FluDAG bears some similarity to running <code class="docutils literal notranslate"><span class="pre">FLUGG</span></code>. The first step is to
create the CAD geometry of the problem you wish to run. In order to produce the
material assignment data from the CAD geometry we must first
<a class="reference internal" href="../cubit_basics.html#geom-production"><span class="std std-ref">facet the file</span></a> using the Cubit plugin. Using the
subsequently-defined geometry file, the user must produce the <code class="docutils literal notranslate"><span class="pre">mat.inp</span></code> file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /path/to/fludag/executable/mainfludag geom.h5m
</pre></div>
</div>
<p>This will load the named .h5m file and produce the material assignment
information. This information should then be pasted into the FLUKA input file,
and any adjustments that need to be made should be made; for example, adding the
density of non standard materials, or adding your scoring information. <strong>Please
note that users must always include the additional material and compound
information themselves and take responsibility to ensure that the FLUKA material
index number does not overlap with one produced by FluDAG.</strong></p>
<p>The FluDAG calculation is now ready to run. First make a symbolic link from the
geometry file to a fixed file called <code class="docutils literal notranslate"><span class="pre">dagmc.h5m</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ln -s geom.h5m dagmc.h5m
</pre></div>
</div>
<p>The problem can then be run with</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ $FLUPRO/flutil/rfluka -e &lt;path/to/fludag/executable/mainfludag&gt; \
      ++{standard fluka options}++ &lt;fludag_input_file&gt;
</pre></div>
</div>
</section>
</section>


          </div>
      </div>

    </div>
</div>
    <div id="footer">
      <p>
        &copy; Copyright 2012-2020, The UW CNERG Team.
      </p>
      <p>
      Last updated on Aug 02, 2022.
      </p>
      <p>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 5.0.1.
      </p>
    </div>
  </body>
</html>