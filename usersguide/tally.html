

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>DAGMC unstructured mesh tallies &#8212; DAGMC</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DAGMC tools" href="tools.html" />
    <link rel="prev" title="Producing solid models for DAGMC using Cubit" href="cubit_workflow.html" /> 
  </head><body> 
<div id="page-div" class="page">
<div id="header">
    <a id="uwhome" href="http://www.wisc.edu"><img src="../_static/images/wordmark.gif" alt="University of Wisconsin–Madison" width="260" height="11" /></a> 
    <a id="crest" href="http://www.wisc.edu"><img src="../_static/images/crest.png" alt="" width="70" height="106" /></a>
    <h1 id="siteTitle"><a href="../index.html"><img src="../_static/images/logo.png" alt="" height="50x" /><span>DAGMC</span></a></h1>
    <div id="tagline"><span>Direct Accelerated Geometry Monte Carlo Toolkit</span></div>
    <ul id="globalnav">
      <li id="uwsearch"><a href="http://www.wisc.edu/search/">UW Search</a></li>
      <li><a href="http://cnerg.github.com">CNERG</a></li>
      <li><a href="http://my.wisc.edu">My UW</a></li>
      <li><a href="http://map.wisc.edu">Map</a></li>
      <li id="last_tool"><a href="http://www.today.wisc.edu">Calendar</a></li>
    </ul>
    <form role="search" action="../search.html" method="get" id="cse-search-box">
      <div>
      <label class="screen-reader-text" for="q">Search for:</label>
      <input type="text" id="q" name="q" value="Enter keywords here...." />
      <input type="submit" id="sa" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
      </div>
    </form>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>

    <div id="nav" class="main-menu-container">
      <ul id="menu-main" class="sf-menu">
        <li class="menu-item"><a href="http://svalinn.github.io">Svalinn</a></li>
        <li class="menu-item"><a href="../index.html">DAGMC</a></li>
        <li class="menu-item" style="margin-right: 10px">
          <a href="cubit_workflow.html" title="Producing solid models for DAGMC using Cubit"
             accesskey="P">previous</a>
          </li>
        <li class="menu-item" >
          <a href="tools.html" title="DAGMC tools"
             accesskey="N">next</a>
          </li>
        <li class="menu-item" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
          </li>
          <li class="menu-item"><a href="index.html" accesskey="U">User’s guide</a></li> 
      </ul>
    </div>
  <div id="c_container"> 
<div id="sidebar">
 <div id="sidebar_section"><ul>
<li><a class="reference internal" href="#">DAGMC unstructured mesh tallies</a><ul>
<li><a class="reference internal" href="#mesh-production-workflow">Mesh production workflow</a></li>
<li><a class="reference internal" href="#tetrahedral-mesh-tallies">Tetrahedral mesh tallies</a></li>
<li><a class="reference internal" href="#kernel-density-estimator-tallies">Kernel density estimator tallies</a></li>
</ul>
</li>
</ul>
 </div>
</div> 
    <div id="content" class="inline-block">
          <div class="post">
            
  <section id="dagmc-unstructured-mesh-tallies">
<h1>DAGMC unstructured mesh tallies<a class="headerlink" href="#dagmc-unstructured-mesh-tallies" title="Permalink to this heading">¶</a></h1>
<p>DAGMC supports several advanced mesh tally options including tetrahedral mesh
tallies (tetmeshes) and kernel density estimator tallies. Both options require
an unstructured mesh.</p>
<section id="mesh-production-workflow">
<h2>Mesh production workflow<a class="headerlink" href="#mesh-production-workflow" title="Permalink to this heading">¶</a></h2>
<p>Cubit can be used to generate the unstructured meshes needed for tallies.
To do so, use the following steps.</p>
<ol class="arabic simple">
<li><p>Load the geometry you wish to mesh into Cubit.</p></li>
<li><p>Use the mesh tools to produce the meshes you want.</p></li>
<li><p>Save the file as a .cub file. Remember to check the “Use Legacy
.cub file Format” option in Cubit.</p></li>
<li><p>Use MOAB’s <code class="docutils literal notranslate"><span class="pre">mbconvert</span></code> executable to convert from the Cubit format
to a faceted .h5m file that DAGMC can use.</p></li>
</ol>
<p>Here is an example of how to use <code class="docutils literal notranslate"><span class="pre">mbconvert</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ mbconvert mesh.cub mesh.h5m
</pre></div>
</div>
<p>One can immediately view this mesh, by using <code class="docutils literal notranslate"><span class="pre">mbconvert</span></code> to convert to vtk:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ mbconvert mesh.h5m mesh.vtk
</pre></div>
</div>
</section>
<section id="tetrahedral-mesh-tallies">
<h2>Tetrahedral mesh tallies<a class="headerlink" href="#tetrahedral-mesh-tallies" title="Permalink to this heading">¶</a></h2>
<p>Currently the tetmesh tally option is only available in DAG-MCNP5/6, but there
are plans to expand this to all the codes that DAGMC currently supports.</p>
<p>Once you have used the above instructions to produce one or more meshes in .h5m
format, you must specify to MCNP that your tally is a tetmesh tally. This is
done by putting special keywords on the tally comment (FC) line. For example,
adding the following lines to an MCNP input file would tell MCNP that tally 4 is
a tetmesh tally, that the input mesh file is <code class="docutils literal notranslate"><span class="pre">mesh.h5m</span></code>, and the results
should be stored in <code class="docutils literal notranslate"><span class="pre">mesh_out.h5m</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fmesh4:n geom=dag
fc4 dagmc type=unstr_track inp=mesh.h5m out=mesh_out.h5m
</pre></div>
</div>
<p>Other standard MCNP options can also be used, such as energy bins:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fmesh4:n geom=dag
         emesh=1.0 2.0 15.0
fc4 dagmc type=unstr_track inp=mesh.h5m out=mesh_out.h5m
</pre></div>
</div>
<p>Or tally multipliers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fmesh4:p geom=dag
fc4 dagmc type=unstr_track inp=mesh.h5m out=mesh_out.h5m
fm4 -1 0 -5 -6
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mbconvert</span></code> can be used to convert the output mesh file to a .vtk file for
viewing or post-processing with <a class="reference external" href="https://wci.llnl.gov/simulation/computer-codes/visit">VisIt</a> or <a class="reference external" href="http://www.paraview.org">ParaView</a> or other plotting tools.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ mbconvert mesh_out.h5m mesh_out.vtk
</pre></div>
</div>
</section>
<section id="kernel-density-estimator-tallies">
<h2>Kernel density estimator tallies<a class="headerlink" href="#kernel-density-estimator-tallies" title="Permalink to this heading">¶</a></h2>
<p>The kernel density estimator tallies are a suite of tallies that allow scoring
to be done using the vertices of a tetmesh or add additional mesh-based scoring
such as collision estimator tallies. The theoretical details behind KDE tallies
can be found in <a class="reference external" href="http://digital.library.wisc.edu/1711.dl/OXDMBPODZJERF8A">Kerry Dunn’s Ph.D. thesis</a>.</p>
<p>To call a KDE collision tally, use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fmesh4:p geom=dag
fc4 dagmc type=kde_coll inp=mesh.h5m out=mesh_out.h5m
    hx=0.198 hy=0.0663 hz=0.0662
</pre></div>
</div>
<p>To call a KDE track length tally, use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fmesh4:p geom=dag
fc4 dagmc type=kde_track inp=mesh.h5m out=mesh_out.h5m
    hx=0.198 hy=0.0663 hz=0.0662
</pre></div>
</div>
<p>To call a KDE subtrack tally, use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fmesh4:p geom=dag
fc4 dagmc type=kde_subtrack inp=mesh.h5m out=mesh_out.h5m
    hx=0.1042 hy=0.0833 hz=0.0833
    hx=0.1042 hy=0.0833 hz=0.0833
    subtracks=3 seed=11699913
</pre></div>
</div>
</section>
</section>


          </div>
      </div>

    </div>
</div>
    <div id="footer">
      <p>
        &copy; Copyright 2012-2020, The UW CNERG Team.
      </p>
      <p>
      Last updated on Aug 02, 2022.
      </p>
      <p>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 5.0.1.
      </p>
    </div>
  </body>
</html>